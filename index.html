<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Monome App</title>
    <!-- <script type="text/javascript" src="app.js"></script> -->
    <script type="text/javascript" src="nexusUI.js"></script>
    <script type="text/javascript" src="tone.js"></script>
    <script>

    var ping = new Tone.PingPongDelay(0.16, 0.7).toMaster();

    var filter = new Tone.Filter(800, "lowpass").connect(ping);

    //a polysynth composed of 6 Voices of MonoSynth
    var synth = new Tone.PolySynth(4, Tone.MonoSynth).connect(filter);
    //set the attributes using the set interface
    synth.set({
      volume: -35,
      oscillator:{
        type:"square6"
      },
      filter:{
        Q:3,
        type:"allpass",
        rolloff:-24
      },
      envelope:{
        attack:0.3,
        decay:0,
        sustain:1,
        release:0.3
      },
      filterEnvelope:{
        attack:0.2,
        decay:0,
        sustain:1,
        release:0.2,
        min:20,
        max:20,
        exponent:2,
      }
    });

nx.onload = function() {
  nx.colorize("accent", "#D7FC89");
  nx.colorize("fill", "#252525");

  matrix1.col = 8;
  matrix1.row = 8;
  matrix1.init();


  matrix1.on('*',function(data) {
    synth.set("detune",~~(Math.random()*10-5));

    if (data.grid) {
      for (var i=0;i<data.grid.length;i++) {
        for (var j=0;j<data.grid[i].length;j++) {

          if (data.grid[i][j]) {
            synth.triggerAttackRelease((j+1)*(i+1)*33, .42);
          }
        }
      }
    }
  });
  <!-- matrix1.matrix[1][2] = 1; -->
    matrix1.draw()
}
    </script>
  </head>
  <body>

    <canvas nx="matrix"></canvas>
    <canvas nx="matrix" id="beatmatrix"></canvas>

    <style>

body {
  background-color:#0e0e0e;
}
    .nx {
      display:block;
    }

    .note {
      width:700px;
      margin:0 auto;
      padding:10px 2px 0px;
      box-sizing:border-box;
    }

    a {
      color:#0be;

    }
    </style>
  </body>

</html>
